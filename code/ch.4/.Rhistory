d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/데이터/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
res_lm
library(rstan)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. ???���??/?ǽ?/ch.4/data-salary.txt')
X_new <- 23:60
data <- list(N=nrow(d), X=d$X, Y=d$Y, N_new=length(X_new), X_new=X_new)
fit <- stan(file='D:/006966_wonderful2/02. ???���??/?ǽ?/ch.4/model4-4.stan', data=data, seed=1234)
ms <- rstan::extract(fit)
data.frame.quantile.mcmc <- function(x, y_mcmc,
probs=c(2.5, 25, 50, 75, 97.5)/100) {
qua <- apply(y_mcmc, 2, quantile, probs=probs)
d <- data.frame(X=x, t(qua))
colnames(d) <- c('X', paste0('p', probs*100))
return(d)
}
ggplot.5quantile <- function(data) {
p <- ggplot(data=data, aes(x=X, y=p50))
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(aes(ymin=p2.5, ymax=p97.5), fill='black', alpha=1/6)
p <- p + geom_ribbon(aes(ymin=p25, ymax=p75), fill='black', alpha=2/6)
p <- p + geom_line(size=1)
return(p)
}
customize.ggplot.axis <- function(p) {
p <- p + labs(x='X', y='Y')
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
p <- p + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
return(p)
}
d_est <- data.frame.quantile.mcmc(x=X_new, y_mcmc=ms$y_base_new)
p <- ggplot.5quantile(data=d_est)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- customize.ggplot.axis(p)
ggsave(file='D:/006966_wonderful2/02. ???���??/?ǽ?/ch.4/fig4-8-left-2.png', plot=p, dpi=300, w=4, h=3)
d_est <- data.frame.quantile.mcmc(x=X_new, y_mcmc=ms$y_new)
p <- ggplot.5quantile(data=d_est)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- customize.ggplot.axis(p)
ggsave(file='D:/006966_wonderful2/02. ???���??/?ǽ?/ch.4/fig4-8-right-2.png', plot=p, dpi=300, w=4, h=3)
library(rstan)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
data <- list(N=nrow(d), X=d$X, Y=d$Y)
fit <- stan(file='model/model4-5.stan', data=data, seed=1234)
save.image(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/result-model4-5.RData')
fit
library(rstan)
library(ggmcmc)
load('D:\006966_wonderful2\02. 원고개발\실습\ch.4/output/result-model4-5.RData')
write.table(data.frame(summary(fit)$summary), file='D:\006966_wonderful2\02. 원고개발\실습\ch.4/output/fit-summary.txt', sep='\t', quote=FALSE, col.names=NA)
ggmcmc(ggs(fit, inc_warmup=TRUE, stan_include_auxiliar=TRUE), file='D:\006966_wonderful2\02. 원고개발\실습\ch.4/output/fit-traceplot.pdf', plot='traceplot')
ggmcmc(ggs(fit), file='D:\006966_wonderful2\02. 원고개발\실습\ch.4/output/fit-ggmcmc.pdf')
# ggmcmc(ggs(fit), file='output/fit-ggmcmc.pdf',
#   plot=c('traceplot', 'density', 'running', 'autocorrelation'))
library(rstan)
library(ggmcmc)
load('D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/result-model4-5.RData')
write.table(data.frame(summary(fit)$summary), file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fit-summary.txt', sep='\t', quote=FALSE, col.names=NA)
ggmcmc(ggs(fit, inc_warmup=TRUE, stan_include_auxiliar=TRUE), file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fit-traceplot.pdf', plot='traceplot')
ggmcmc(ggs(fit), file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fit-ggmcmc.pdf')
# ggmcmc(ggs(fit), file='output/fit-ggmcmc.pdf',
#   plot=c('traceplot', 'density', 'running', 'autocorrelation'))
library(rstan)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
data <- list(N=nrow(d), X=d$X, Y=d$Y)
stanmodel <- stan_model(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/model/model4-5.stan')
fit <- sampling(
stanmodel,
data=data,
pars=c('b', 'sigma'),
init=function() {
list(a=runif(1,-10,10), b=runif(1,0,10), sigma=10)
},
seed=123,
chains=3, iter=1000, warmup=200, thin=2
)
library(rstan)
d <- read.csv(file='…/ch.4/input/data-salary.txt')
data <- list(N=nrow(d), X=d$X, Y=d$Y)
stanmodel <- stan_model(file='…/ch.4/model/model4-5.stan')
fit <- sampling(
stanmodel,
data=data,
pars=c('b', 'sigma'),
init=function() {
list(a=runif(1, -10, 10), b=runif(1, 0, 10), sigma=10)
},
seed=123,
chains=3, iter=1000, warmup=200, thin=2
)
library(rstan)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
data <- list(N=nrow(d), X=d$X, Y=d$Y)
stanmodel <- stan_model(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/model/model4-5.stan')
fit <- sampling(
stanmodel,
data=data,
pars=c('b', 'sigma'),
init=function() {
list(a=runif(1, -10, 10), b=runif(1, 0, 10), sigma=10)
},
seed=123,
chains=3, iter=1000, warmup=200, thin=2
)
load('D:/006966_wonderful2/02. 원고개발/실습/ch.4/result-model4-5.RData')
ms <- rstan::extract(fit)
ms$b
load('D:/006966_wonderful2/02. 원고개발/실습/ch.4/result-model4-5.RData')
ms <- rstan::extract(fit)
quantile(ms$b, probs=c(0.025, 0.975))
d_mcmc <- data.frame(a=ms$a, b=ms$b, sigma=ms$sigma)
head(d_mcmc)
library(rstan)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
X_new <- 23:60
data <- list(N=nrow(d), X=d$X, Y=d$Y, N_new=length(X_new), X_new=X_new)
fit <- stan(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/model/model4-4.stan', data=data, seed=1234)
ms <- rstan::extract(fit)
data.frame.quantile.mcmc <- function(x, y_mcmc,
probs=c(2.5, 25, 50, 75, 97.5)/100) {
qua <- apply(y_mcmc, 2, quantile, probs=probs)
d <- data.frame(X=x, t(qua))
colnames(d) <- c('X', paste0('p', probs*100))
return(d)
}
ggplot.5quantile <- function(data) {
p <- ggplot(data=data, aes(x=X, y=p50))
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(aes(ymin=p2.5, ymax=p97.5), fill='black', alpha=1/6)
p <- p + geom_ribbon(aes(ymin=p25, ymax=p75), fill='black', alpha=2/6)
p <- p + geom_line(size=1)
return(p)
}
customize.ggplot.axis <- function(p) {
p <- p + labs(x='X', y='Y')
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
p <- p + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
return(p)
}
d_est <- data.frame.quantile.mcmc(x=X_new, y_mcmc=ms$y_base_new)
p <- ggplot.5quantile(data=d_est)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- customize.ggplot.axis(p)
ggsave(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-8-left-2.png', plot=p, dpi=300, w=4, h=3)
d_est <- data.frame.quantile.mcmc(x=X_new, y_mcmc=ms$y_new)
p <- ggplot.5quantile(data=d_est)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- customize.ggplot.axis(p)
ggsave(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-8-right-2.png', plot=p, dpi=300, w=4, h=3)
head(ms$y_new[ ,1:4])
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
p <- ggplot(data=d, aes(x=X, y=Y))
p <- p + theme_bw(base_size=18)
p <- p + geom_point(shape=1, size=3)
ggsave(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-2.png', plot=p, dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=conf_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=conf_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=conf_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(200, 1400))
p <- p + scale_y_continuous(breaks=seq(from=200, to=1400, by=400))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-left.png', dpi=300, w=4, h=3)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(200, 1400))
p <- p + scale_y_continuous(breaks=seq(from=200, to=1400, by=400))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=conf_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=conf_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=conf_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(200, 1400))
p <- p + scale_y_continuous(breaks=seq(from=200, to=1400, by=400))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-left.png', dpi=300, w=4, h=3)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(200, 1400))
p <- p + scale_y_continuous(breaks=seq(from=200, to=1400, by=400))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=conf_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=conf_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=conf_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/fig4-3-left.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(200, 1400))
p <- p + scale_y_continuous(breaks=seq(from=200, to=1400, by=400))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=pred_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=pred_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=pred_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-right.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=conf_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=conf_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=conf_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/fig4-3-left.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=conf_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=conf_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=conf_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/putput/fig4-3-left.png', dpi=300, w=4, h=3)
library(ggplot2)
d <- read.csv(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/input/data-salary.txt')
res_lm <- lm(Y ~ X, data=d)
X_new <- data.frame(X=23:60)
conf_95 <- predict(res_lm, X_new, interval='confidence', level=0.95)
conf_95 <- data.frame(X_new, conf_95)
conf_50 <- predict(res_lm, X_new, interval='confidence', level=0.50)
conf_50 <- data.frame(X_new, conf_50)
pred_95 <- predict(res_lm, X_new, interval='prediction', level=0.95)
pred_95 <- data.frame(X_new, pred_95)
pred_50 <- predict(res_lm, X_new, interval='prediction', level=0.50)
pred_50 <- data.frame(X_new, pred_50)
p <- ggplot()
p <- p + theme_bw(base_size=18)
p <- p + geom_ribbon(data=conf_95, aes(x=X, ymin=lwr, ymax=upr), alpha=1/6)
p <- p + geom_ribbon(data=conf_50, aes(x=X, ymin=lwr, ymax=upr), alpha=2/6)
p <- p + geom_line(data=conf_50, aes(x=X, y=fit), size=1)
p <- p + geom_point(data=d, aes(x=X, y=Y), shape=1, size=3)
p <- p + labs(x='X', y='Y') + coord_cartesian(xlim=c(22, 61), ylim=c(2000, 14000))
p <- p + scale_y_continuous(breaks=seq(from=2000, to=14000, by=4000))
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-3-left.png', dpi=300, w=4, h=3)
library(ggmcmc)
load(D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/result-model4-5.RData')
p <- ggs_traceplot(ggs(fit, inc_warmup=TRUE, stan_include_auxiliar=TRUE))
p <- p + theme_bw(base_size=18)
p <- p + scale_colour_manual(values=c('#dcdcdc','#a9a9a9','#696969','#000000'))
p <- p + labs(color='Chain')
ggsave(p, file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-4.png', dpi=300, w=7, h=10)
library(ggplot2)
source('D:/006966_wonderful2/02. 원고개발/실습/common.R')
load('D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/result-model4-5.RData')
ms <- rstan::extract(fit)
df_mcmc <- data.frame(a=ms$a, b=ms$b, sigma=ms$sigma)
p_xy <- ggplot(df_mcmc,aes(x=a,y=b)) +
my_theme() +
geom_point(alpha=1/4, size=2, shape=1) +
scale_x_continuous(breaks=seq(-4000, 2000, 2000), limits=c(-4200, 2100)) +
scale_y_continuous(breaks=seq(150, 250, 50), limits=c(145, 290))
p_x <- ggplot(df_mcmc, aes(x=a)) +
my_theme0() +
geom_histogram(aes(y=..density..), colour='black', fill='white') +
geom_density(alpha=0.3, fill='gray20') +
scale_x_continuous(breaks=seq(-4000, 2000, 2000), limits=c(-4200, 2100)) +
labs(x='', y='')
p_y <- ggplot(df_mcmc, aes(x=b)) +
my_theme0() +
coord_flip() +
geom_histogram(aes(y=..density..), colour='black', fill='white') +
geom_density(alpha=0.3, fill='gray20') +
scale_x_continuous(breaks=seq(150, 250, 50), limits=c(145, 290)) +
labs(x='', y='')
p_emp <- ggplot(data.frame(0,0)) + theme_bw() + theme(rect=element_rect(fill='white'), panel.border=element_blank())
g_xy <- ggplotGrob(p_xy)
g_x <- ggplotGrob(p_x)
g_y <- ggplotGrob(p_y)
g_emp <- ggplotGrob(p_emp)
g1 <- cbind(g_x, g_emp, size='first')
g2 <- cbind(g_xy, g_y, size='first')
g <- rbind(g1, g2, size='last')
g$widths[1:3] <- grid::unit.pmax(g1$widths[1:3], g2$widths[1:3])
g$heights[8:13] <- g$widths[8:13] <- rep(unit(0.5,'mm'), 6)
g$heights[7] <- g$widths[14] <- unit(3,'cm')
png(file='D:/006966_wonderful2/02. 원고개발/실습/ch.4/output/fig4-77.png', res=300, w=1800, h=1800)
grid::grid.draw(g)
dev.off()
